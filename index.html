<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic MIDI Player</title>
</head>
<body>
    <h1>Basic MIDI Player</h1>
    <select id="instrumentSelect">
        <option value="acoustic_grand_piano">Acoustic Grand Piano</option>
        <option value="church_organ">Church Organ</option>
        <option value="violin">Violin</option>
        <!-- Add more instruments as needed -->
    </select>
    <button id="playButton">Play MIDI</button>

    <script src="https://cdn.jsdelivr.net/npm/@magenta/music"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.35/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tonejs/midi"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const soundfontUrl = "https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/";
            const instrumentSelect = document.getElementById('instrumentSelect');
            const playButton = document.getElementById('playButton');
            let currentInstrument = 'acoustic_grand_piano';

            // Load instrument samples
            async function loadInstrument(instrument) {
                const response = await fetch(`${soundfontUrl}${instrument}/instrument.json`);
                const instrumentData = await response.json();
                const samples = {};

                for (let note in instrumentData) {
                    samples[note] = `${soundfontUrl}${instrument}/${instrumentData[note]}`;
                }

                return samples;
            }

            // Change instrument
            function changeInstrument(instrument) {
                currentInstrument = instrument;
            }

            // Play MIDI file
            playButton.addEventListener('click', async function () {
                const midiUrl = 'https://yahnjr.github.io/map2midi/tracks/Copper.mid';
                const midiData = await fetch(midiUrl).then(response => response.arrayBuffer());
                const midi = new Midi(midiData);

                // Load instrument samples
                const samples = await loadInstrument(currentInstrument);
                const sampler = new Tone.Sampler({
                    urls: samples
                }).toDestination();

                // Schedule the notes
                midi.tracks.forEach(track => {
                    track.notes.forEach(note => {
                        const time = note.time;
                        const duration = note.duration;
                        const midiNote = note.midi;
                        sampler.triggerAttackRelease(Tone.Frequency(midiNote, "midi"), duration, time);
                    });
                });

                // Start Tone.js transport
                Tone.Transport.start();
            });

            // Event listener for dropdown change
            instrumentSelect.addEventListener('change', function () {
                const instrument = this.value;
                changeInstrument(instrument);
            });
        });
    </script>
</body>
</html>
